<html>
	<head>
		<title>DEMOS - vv4t</title>
		<link rel="shortcut icon" type="image/png" href="/assets/favicon.png"/>
		<link rel="stylesheet" href="/css/page.css">
		<link rel="stylesheet" href="/posts/article.css">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
		<meta charset="utf-8">
	</head>
  <body>
    <iframe src="/nav.html"></iframe>
		<div class="main">
			<h1>LOGIN</h1>
      <br>
      <h2>Hint: the password is 'abc123'</h2>
      <input style="background-color: black; color: white; font-size: 20px;" type="text" id="pwd" placeholder="Password">
    </div>
    <script type="text/javascript" src="https://cdn.rawgit.com/ricmoo/aes-js/e27b99df/index.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/scrypt-js/3.0.1/scrypt.js"></script>
<script>
function page_login(pwd)
{
  const key = gen_pwd(pwd, "abc123!@#");
  const aes_ctr = new aesjs.ModeOfOperation.ctr(key);
  
  const str_verify = "b6d65d4e03b1f035339a2d600204c91f4c31b1f19e23d73daf489ffe946f0930f1cf08ddf449244859080e62480184";
  const key_verify = aesjs.utils.utf8.fromBytes(aes_ctr.decrypt(aesjs.utils.hex.toBytes(str_verify)));
  
  if (key_verify != "minna chiruno no sansei kyoushitsu hajimaru yo~")
    return false;
  
  const payload = "70809916315245b1f985a1f9894a8150cc4678990cf74fec1e6f7902205a84f8afc244c8697b10f2decd63a843aff73c76eac58354e0c8fa9490518f4c0d956b42cc5518c6705d676bef8e2b070770654e2172ddea5e49a3a7fe55fce3d4c69f53762726b67815844af2be132bb61c309fdb53f0cf34efa0706d06e3e076d01590f60507e3cd6d564067a66df9173a63aae5848552a4779fc0ffc8f7a6bf4b983efaab686058cb99811bcb5f97eab312b255d7898e5aa4036952a03e4b7a69ebc2b0fcca40914b758f63269ff59be3570b18fa60b48cd89fada7f9da022fc9be3db0a0ac8696c6fc405c4264f622cb087defc1cc82c205634808125f34d9c5c5b761f1ba233f8ac596645d45e8b9aebb6fd92d2f01b36fb4968a13f800518ed717c8938a43b60812528ad09147e5ecb36776510628c844c76c590cf6dc90dcdc8b1ca84ab9bbe8c4c258c744a8db21b18dbfd3255208acf6b6cb5b5e260106cb07f52ff96ca63c763ffc4e492c63f3534750ebed6811ab4e4c43118379ac12faa536a69523086b72693764461d75b428109906dad6a2c65e889e91d5af0866c776c911031896b31df463f403dfc1e2d17269ad351cf0cf0fb8c78d15a5c3d1970441423ee2158da9c03322ff2d56113f3b46e6402f39eee9476ecdf1218295a288572c80d5a3a93290b5a5a9352435a50009c3a1086448db0e204df200320db67c39eb560b1b805220eeb9f247f82a730aa4082fb13471eb17bf28e85644b0cc95662db8f8736e22db31b7ec07922bc5c096f2e9edcbde00b010b5a3771a7529a62ac694a77c535a711263faff743119cbbaba9e7cce72b6cb5c7f634aff4a980784e8a03aa6343ea6e2c8787ca2e8a03acf5af665983296f72ea2ebf22c51faa92c0bf61ef7e0232254976f6cbbc7474eb6e753b842cf7c560c6ffebf99f8b2f5587600f869cffe96631c437733e5f5aa2cec913eccb8abc0fbbec02b803def2c39e0b9b3973d3b3df1ab26d19512ef8f44e4518eb28fcc9b765379a5e19c7fa75dad567c8bad05f6ef2dc18848284a34073a12c7d151b68d382171fc6cdffe2761e1605f0a523298ed699878b045638b3903225fb1ec33145f548a7c090586fab41ace1f3385748d59f537c3c207970f72505076bc77f81bd7f9e05ce0f010defe4456f36e33ca4c9439316791b964dab8ea1c89e55024be4ad472550f5da22dd4db7626a356233a5588bdab216233416272c8b3132a1ee97d632fa447cc905552ccd3f7dc6def7958ac0abe4b6dbf169d41ce9788257e26e51dbd0bf27abf64a96067bea9d4f755a855f7f5b1e223a2bec1022adceb1c42551f2ff9d336680ab5edd120a38a185996afd449a2046ce1d3ec10c3b028c99b9929e0a0f8af9197000fc798458d095c955c14979deec4d1e739402505c54311bbea6093d870ee55ca9a4defa19d076fcf8e40b01c4a394501533f5ed10833e4a6f130b97e80d11d94687709ca1585781eece5849dd6d255c5af56a76ca638b2f7589eaefab1674deb88c260f3dff747f1e1dfd6ce22657a4dffe5bcd8fa776d921cb9f0966cd5f843b448b43acbcc3fb27685847768dc735e92cfe0ad333557737b6ebef4a35e29f71196a55fc494ddd3c0ffb672a3353f36cb4fe20685594dd76c1b2d983c09716a0cd997cc290a52ea94628efb1e508e9e3b86e46e8421d09e7fa1a66e08f8426f0d5994988ae8248dd29b6d3c550479d906bb2df12dede1e451f607849dd79a7283fccc0fa5c766b328fc7e3f885de1282e31c725864237c7bec8e94860bcdfbb58e458a5a5cbac88ecaaa7e785cec3cf744fb222c1592109590bcc2ac3740f53c2139230c3276fbeec7b56615f741681ca919a41b2f7cabe049887c3e0a1c97674c59b5d2ea246b81a1b6e0238c5c917efbb4134addfc584e92cd288d0189e8fdad93225d2ce2a2e5ee8720069ab2442c0d4a2355079ff126a81cb5188558f04a380a94862bc8216e72ba9ffe7e11e6159f26b69759ea67e29d94dfce7a8f2f9c4d080b8cc21f5376dd771fc06156359b09bf61649321271523e822fcea025441c810648987f070f8e1bddbec6f6664791c7fde600cfbf8081d936b724139f63dac6c6f2e787544fef3530360d430b4fa104c97b2cf7885c0b4c6bd318c1fc66ec4ea8e263e9382fec9c77eb8b9078d2c49bf552db5b1f7071d9e4ee296e85b6a26e5f7d5ccadd0254532b09d2b308fe7d80ea00a13566f6e7bdf69dc6984c117bd25e1150f85b21015901ca9a98bc235179760e671449d88dd04345d97b557676dd3467547c568de759f8170236db257ee6dd2f0d12060722efa70e02bc683d02988c8be0d78f41c9172d7e1d1dd326ed2e63d3a42de999003c2798f250936be5833156db3d001ccb53d194def9b9e5f5324fc2d6200ed3ba44e483bdfb167926ac1f896deb85783cc6cd27bc7497c0e3b85272ad7ac587227346ae4d17066a6c33cd0bc0f104dd612fe41b48baf1ffe247906dc07edf7d7891f9554b2a5f7da7ca73705ae70a63a50a7cdf1df59c835ac7cf283311a95863303144f4d94e5eb9d28eaaa8286db7aa94a2679d07093eaa965f2f12589a537df848a2a61f26a03c8252864a18935b747927f81597480a9f762957ac992a2f4c240245b6a96953951c197d5ec1d8de707fa17786d7cdeb98567f2983e5028746a10b7e8054d964c15443e2cc85ba29338f825b1e5507bbc859188b18b23443a343d6282ac6715d7967df87a2d3757626c501d79c2d4e334690ab0fc73618626cce7451c8f313dfa9df9713e06dde4da019eac80c5147eddd0c5a432a4822a9c99bea68829abce82c07ef8b0e78d22edb28c6d229decf7a1de079a02f5b11af94f61bfe0d90dd7468be3acae40777fca299dcbb0b0db48bfa682fbb82c301d8110776d40148456575a2551787cfc5a964377020b21f248858e2d8f9373d899d332921a91900e881292294dc2d52b6b13dc9814afd65903dce5b43a54ff53c7c472c9da797454f7a7a07903943f7769de790a7c4b93822e5c80c5993a051cd492ba3d2099ae41410ccaa5cc15ecf25e35fb8b7a162504e0f99826029b8999a9c25fe65759f5e00cc6fd82e92d811224a2eae992230dfe146bfd5ae3c0ea164a4c74cee5c990a2cf0298d6203da72361f78db6daaa814808324ab4a37eb33548e2b69c07f5c30dd47e75568c6ba5390321c7e71609d5bfeaf9da96d5a9872b3";
  const content = aesjs.utils.utf8.fromBytes(aes_ctr.decrypt(aesjs.utils.hex.toBytes(payload)));
  const html = document.createElement("html");
  html.innerHTML = content;

  document.head.innerHTML = "";
  document.body.innerHTML = "";

  while (html.children[0].childNodes.length)
    document.head.appendChild(html.children[0].childNodes[0]);

  while (html.children[1].childNodes.length)
    document.body.appendChild(html.children[1].childNodes[0]);

  unpack_node(document.head, key);
  unpack_node(document.body, key);
  
  return true;
}

function gen_pwd(pwd, salt)
{
  const bytes_pwd = aesjs.utils.utf8.toBytes(pwd.normalize("NFKC"));
  const bytes_salt = aesjs.utils.utf8.toBytes(salt.normalize("NFKC"));

  const N = 1024, r = 8, p = 1;
  const dkLen = 32;
  
  return scrypt.syncScrypt(bytes_pwd, bytes_salt, N, r, p, dkLen);
}

async function unpack_node(node, key)
{
  for (const child_node of node.children) {
    unpack_node(child_node, key);
    
    const node_href = await load_attribute_resource(child_node, "href", key);
    const node_src = await load_attribute_resource(child_node, "src", key);
    
    await Promise.all([node_href, node_src]);
    
    if (node_href)
      child_node.setAttribute("href", node_href);
    if (node_src)
      child_node.setAttribute("src", node_src);
  }
  
  reload_js(node);
}

async function load_attribute_resource(node, attr, key)
{
  return new Promise((resolve, reject) => {
    const reg_exp = new RegExp(/{{{\$encrypt\:(.+)}}}/gm);
    const node_attr = node.getAttribute(attr);
    const match_attr = reg_exp.exec(node_attr);
    
    if (match_attr) {
      decrypt_resource(key, match_attr[1]).then((blob_url) => {
        resolve(blob_url);
      });
    } else {
      resolve(null);
    }
  });
}

function reload_js(node)
{
  const to_add = [];
  const to_remove = [];
  
  for (const child_node of node.children) {
    if (child_node.nodeName == "SCRIPT") {
      const new_script_node = document.createElement("SCRIPT");
      new_script_node.innerText = child_node.innerText;
      if (child_node.src)
        new_script_node.src = child_node.src;
      
      to_remove.push(child_node);
      to_add.push(new_script_node);
    }
  }
  
  for (const script_node of to_remove)
    node.removeChild(script_node);
  
  for (const script_node of to_add)
    node.appendChild(script_node);
}

async function decrypt_resource(key, url)
{
  return new Promise((resolve, reject) => {
    const enc_bin_url = url + ".enc";
    
    const xhr = new XMLHttpRequest();
    xhr.open("GET", enc_bin_url);
    xhr.responseType = 'arraybuffer';
    
    xhr.onload = (e) => {
      const enc_text = new Uint8Array(xhr.response);
      
      const aes_ctr = new aesjs.ModeOfOperation.ctr(key);
      const byte_array = aes_ctr.decrypt(enc_text);
      
      const blob = new Blob([byte_array]);
      const blob_url = URL.createObjectURL(blob);
      
      resolve(blob_url);
    };
    
    xhr.send();
  });
}
</script>

    <script>
      const input_pwd = document.getElementById("pwd");
      pwd.addEventListener("keyup", (e) => {
        if (e.key == "Enter") {
          if (!page_login(pwd.value))
            alert("incorrect password");
        }
      });
    </script>
	</body>
</html>

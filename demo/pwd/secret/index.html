<html>
	<head>
		<title>DEMOS - vv4t</title>
		<link rel="shortcut icon" type="image/png" href="/assets/favicon.png"/>
		<link rel="stylesheet" href="/css/page.css">
		<link rel="stylesheet" href="/posts/article.css">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
		<meta charset="utf-8">
	</head>
  <body>
    <iframe src="/nav.html"></iframe>
		<div class="main">
			<h1>LOGIN</h1>
      <br>
      <h2>Hint: the password is 'abc123'</h2>
      <input style="background-color: black; color: white; font-size: 20px;" type="text" id="pwd" placeholder="Password">
    </div>
    <script type="text/javascript" src="https://cdn.rawgit.com/ricmoo/aes-js/e27b99df/index.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/scrypt-js/3.0.1/scrypt.js"></script>
<script>
function page_login(pwd)
{
  const key = gen_pwd(pwd, "abc123!@#");
  const aes_ctr = new aesjs.ModeOfOperation.ctr(key);
  
  const str_verify = "b6d65d4e03b1f035339a2d600204c91f4c31b1f19e23d73daf489ffe946f0930f1cf08ddf449244859080e62480184";
  const key_verify = aesjs.utils.utf8.fromBytes(aes_ctr.decrypt(aesjs.utils.hex.toBytes(str_verify)));
  
  if (key_verify != "minna chiruno no sansei kyoushitsu hajimaru yo~")
    return false;
  
  const payload = "70809916315245b1f985a1f9894a8150cc4678990cf74fec1e6f7902205a84f8afc244c8697b10f2decd63a843aff73c76eac58354e0c8fa9490518f4c0d956b42cc5518c6705d676bef8e2b070770654e2172ddea5e49a3a7fe55fce3d4c69f53762726b67815844af2be132bb61c309fdb53f0cf34efa0706d06e3e076d01590f60507e3cd6d564067a66df9173a63aae5848552a4779fc0ffc8f7a6bf4b983efaab686058cb99811bcb5f97eab312b255d7898e5aa4036952a03e4b7a69ebc2b0fcca40914b758f63269ff59be3570b18fa60b48cd89fada7f9da022fc9be3db0a0ac8696c6fc405c4264f622cb087defc1cc82c205634808125f34d9c5c5b761f1ba233f8ac596645d45e8b9aebb6fd92d2f01b36fb4968a13f800518ed717c8938a43b60812528ad09147e5ecb36776510628c844c76c590cf6dc90dcdc8b1ca84ab9bbe8c4c258c744a8db21b18dbfd3255208acf6b6cb5b5e260106cb07f52ff96ca63c763ffc4e492c63f3534750ebed6811ab4e4c43118379ac12faa536a69523086b72693764461d75b428109906dad6a2c65e889e91d5af0866c776c911031896b31df463f403dfc1e2d17269ad351cf0cf0fb8c78d15a5c3d1970441423ee2158da9c03322ff2d56113f3b46e6402f39eee9476ecdf1218295a288572c80d5a3a93290b5a5a9352435a50009c3a1086448db0e204df200320db67c39eb560b1b805220eeb9f247f82a730aa4082fb13471eb17bf28e85644b0cc95662db8f8736e22db31b7ec07922bc5c096f2e9edcbde00b010b5a3771a7529a62ac694a77c535a711263faff743119cbbaba9e7cce72b6cb5c7f634aff4a980784e8a03aa6343ea6e2c8787ca2e8a03acf5af665983296f72ea2ebf22c51faa92c0bf61ef7e0232254976f6cbbc7474eb6e753b842cf7c560c6ffebf99f8b2f5587600f869cffe96631c427667a0feb763a0cd2cdca0b68bbca5c6759f2ca46732bcfefd873d2170a7ea3ec3c319eec251f44787f59187d724133ea2f6c53ef554e7564daee448b1f131cedc00366702086e40d9fc7bb68d38216df3388dfc051fa9251e4e4c1fb2ed75972cf80022cf3b7a4a10f5b52d3975548a605d47c9beed04e32967d76aa073f537c3c2078b5b204e7d5cbc6bac5fd7aab405acb50ddcb6554aa73026df49966a293397a47e83bcf457d0df026dae0fd36b511a1abc10cf926068a9493b2d44cdb0e42e73391c1d0198e7566e02e62927318971c3c4074ce1f9f7dc6def6557f858bc6913fd59d918d0baa2256229b15ff253a430d30ce525799383d4eb5afc14b5a5a0bd4cc4fbdf2f00dceb0000070102d3cf62204ff4a9d359c8c8541c8882fe49a2046cfd87be0ef2ce608cdadd37cd8af8af9197001393d05b915c45804270f980ec8798b5770f27058d0658e0f67c90f749fe459ac24feff2cf4472cdd51beb044c3648054b3c0a820f67b4abff70a56f948e409a3e30598041ca7d4fa2ae9587d2ff6e95f756f423ea71f6f70fcae8faa67b6096c18634bbc2f551e1edd282ce226d791b86d2becbea676f8c00b6af8360ccfd49b448b43acbcc3fb27685847768c0270c8cfe99ee617c07277b3decb7be5c72b01ed6e042d39fc8c689e7b174a9286223894cf615c2040c8c3e403b896c5e55765ba7bd83674f52bedb2d92f44a1490af1ed2ac70a90bd09e7fa1a67207ac10713c7cc0ca94c50e8dd29b71330146368150f1489e6ca9ffc97bf61b8bc996d83ec6feb567ea833fad05d6627dda43cc022e31c7259a16798dd2a0a50d7e91f5bb58e458a5a5cbb0c0fce2b1f2989cabf8761bf77a95546045104c9e64912967379656c032dd5327fbec2815330a700a9fb5eed40ffbb98dbe50d0ce90e0e89a762dc8994121b341fd17437c543f9aaa6baee84334fe8b9cc8ac31ccc5cb18c4e7a2c3323482962a7d11b834102bb328528abc8a350730bb462280c613d907c141f5e8ca0f2ae89f14f427fbafe7d03b2218bc3d28269cdf156b9508e2ca82f2f9c4d080b8cc21f53066c079e84c381a0bf386f44d126916341c61842480d915175fd34f18cc714d5cd34680a08ca27739f895b4b654d192aa81d936b724139f7f9e8f90f2acc14453b90518251d53094fe941803c64bf9a0a4f4256fb1882b027bf1db5e02ca32f35ec8931eb8b9078d2c49bf552db5b03243396a0b73743b3e5f22f117d1f869c5107527d0989da20e00fc5ae1cae6636b7a9a3eac3c0c261682f8b12544dfa0f64590d0c8bd6d1fb6d572a650a67404fc6ce9d64109e3c547061da662d337c4686e70cb9035223dd7231a4c662207d484470b6f75a47f8743256dc92a6cad793129956637e5e519269b167338fc552ac9b1e5e6bcdb74c8037e180300c9e617f28e679d194def9a5eaa1730d8e933e23f9a64ba0caebe5271174b232a36deb85783cc6d173e1398fcde3b85272ad7ac587227346b219434c7f7a33cd0bc0f104dd612fe41b54b5b9e3f518f959ed54df7d7891f9554b2a4329f9d17f3769e02063a50a7cdf1df59c835adb9b7a3178ca0e63677800a091535caac29eb4fc2428adb985ba3f82134d6bf0c211221f428e0065ab4ea4ba0e37f020b10cce034b9312277974ac4cdb0d4e9f34704bbe876b2402241c5db5ae3115c70a09260cf6ced22935a63bc8cd97e9f72e6104a9e5028746a10b7e9c5b8d36df7969e2cc99e97972c182045d4016a7910241f477f77a41bd24847160dc2c10667280e496e61e3837ac62818200641a5a9fe940836f064f46d27b05cfee1e8f84b6";
  const content = aesjs.utils.utf8.fromBytes(aes_ctr.decrypt(aesjs.utils.hex.toBytes(payload)));
  const html = document.createElement("html");
  html.innerHTML = content;

  document.head.innerHTML = "";
  document.body.innerHTML = "";

  while (html.children[0].childNodes.length)
    document.head.appendChild(html.children[0].childNodes[0]);

  while (html.children[1].childNodes.length)
    document.body.appendChild(html.children[1].childNodes[0]);

  unpack_node(document.head, key);
  unpack_node(document.body, key);
  
  return true;
}

function gen_pwd(pwd, salt)
{
  const bytes_pwd = aesjs.utils.utf8.toBytes(pwd.normalize("NFKC"));
  const bytes_salt = aesjs.utils.utf8.toBytes(salt.normalize("NFKC"));

  const N = 1024, r = 8, p = 1;
  const dkLen = 32;
  
  return scrypt.syncScrypt(bytes_pwd, bytes_salt, N, r, p, dkLen);
}

async function unpack_node(node, key)
{
  for (const child_node of node.children) {
    unpack_node(child_node, key);
    
    const node_href = await load_attribute_resource(child_node, "href", key);
    const node_src = await load_attribute_resource(child_node, "src", key);
    
    await Promise.all([node_href, node_src]);
    
    if (node_href)
      child_node.setAttribute("href", node_href);
    if (node_src)
      child_node.setAttribute("src", node_src);
  }
  
  reload_js(node);
}

async function load_attribute_resource(node, attr, key)
{
  return new Promise((resolve, reject) => {
    const reg_exp = new RegExp(/{{{\$encrypt\:(.+)}}}/gm);
    const node_attr = node.getAttribute(attr);
    const match_attr = reg_exp.exec(node_attr);
    
    if (match_attr) {
      decrypt_resource(key, match_attr[1]).then((blob_url) => {
        resolve(blob_url);
      });
    } else {
      resolve(null);
    }
  });
}

function reload_js(node)
{
  const to_add = [];
  const to_remove = [];
  
  for (const child_node of node.children) {
    if (child_node.nodeName == "SCRIPT") {
      const new_script_node = document.createElement("SCRIPT");
      new_script_node.innerText = child_node.innerText;
      if (child_node.src)
        new_script_node.src = child_node.src;
      
      to_remove.push(child_node);
      to_add.push(new_script_node);
    }
  }
  
  for (const script_node of to_remove)
    node.removeChild(script_node);
  
  for (const script_node of to_add)
    node.appendChild(script_node);
}

async function decrypt_resource(key, url)
{
  return new Promise((resolve, reject) => {
    const enc_bin_url = url + ".enc";
    
    const xhr = new XMLHttpRequest();
    xhr.open("GET", enc_bin_url);
    xhr.responseType = 'arraybuffer';
    
    xhr.onload = (e) => {
      const enc_text = new Uint8Array(xhr.response);
      
      const aes_ctr = new aesjs.ModeOfOperation.ctr(key);
      const byte_array = aes_ctr.decrypt(enc_text);
      
      const blob = new Blob([byte_array]);
      const blob_url = URL.createObjectURL(blob);
      
      resolve(blob_url);
    };
    
    xhr.send();
  });
}
</script>

    <script>
      const input_pwd = document.getElementById("pwd");
      pwd.addEventListener("keyup", (e) => {
        if (e.key == "Enter") {
          if (!page_login(pwd.value))
            alert("incorrect password");
        }
      });
    </script>
	</body>
</html>
